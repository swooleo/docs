{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u4ecb\u7ecd Swoole \u662f\u4e00\u4e2a\u9762\u5411\u751f\u4ea7\u73af\u5883\u7684 PHP \u534f\u7a0b\u6846\u67b6\u3002 \u6ce8\u610f \u672c\u6587\u6863\u59cb\u7ec8\u4ee5\u6700\u65b0\u7684 Swoole \u4e3a\u51c6\u3002","title":"\u4ecb\u7ecd"},{"location":"#_1","text":"Swoole \u662f\u4e00\u4e2a\u9762\u5411\u751f\u4ea7\u73af\u5883\u7684 PHP \u534f\u7a0b\u6846\u67b6\u3002","title":"\u4ecb\u7ecd"},{"location":"#_2","text":"\u672c\u6587\u6863\u59cb\u7ec8\u4ee5\u6700\u65b0\u7684 Swoole \u4e3a\u51c6\u3002","title":"\u6ce8\u610f"},{"location":"\u5feb\u901f\u5f00\u59cb/","text":"\u5feb\u901f\u5f00\u59cb Swoole \u53ef\u4ee5\u901a\u8fc7 Pecl \u6216\u8005\u6e90\u7801\u6765\u8fdb\u884c\u5b89\u88c5\u3002 Pecl\uff08\u63a8\u8350\uff09 \u9996\u5148\u901a\u8fc7 pecl \u5de5\u5177\u4e0b\u8f7d\u548c\u7f16\u8bd1 Swoole \u6269\u5c55\uff1a # \u5b89\u88c5\u6700\u65b0\u7248\u672c pecl install swoole # \u5b89\u88c5\u6307\u5b9a\u7248\u672c pecl install swoole-4.4.8 \u7f16\u8bd1\u6210\u529f\u4e4b\u540e\uff0c\u628a Swoole \u6dfb\u52a0\u5230 php.ini \u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u3002\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u67e5\u627e\uff0c\u4f8b\u5982\uff1a php --ini Configuration File (php.ini) Path: /etc Loaded Configuration File: /etc/php.ini Scan for additional .ini files in: /etc/php.d \u63a8\u8350\u5728 additional .ini \u76ee\u5f55\u91cc\u9762\u5355\u72ec\u4e3a Swoole \u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a touch /etc/php.d/swoole.ini cat > /etc/php.d/swoole.ini <<EOF ; Enable swoole extension module extension=swoole.so EOF \u6e90\u7801\u5b89\u88c5 \u4e0b\u8f7d\u4e00\u4efd\u5df2\u7ecf release \u7684 Swoole \u6e90\u7801\uff1a curl -L https://github.com/swoole/swoole-src/archive/v4.4.12.tar.gz -o swoole-src-4.4.12.tar.gz \\ && tar -xvf swoole-src-4.4.12.tar.gz \\ && cd swoole-src-4.4.12 \\ && phpize \\ && ./configure \\ && make -j4 \\ && make install \u7136\u540e\u6309\u7167\u4e0a\u9762\u7684\u65b9\u5f0f\u628a Swoole \u6dfb\u52a0\u5230\u914d\u7f6e\u6587\u4ef6 php.ini \u91cc\u9762\u5373\u53ef\u3002 \u9a8c\u8bc1\u662f\u5426\u5b89\u88c5\u6210\u529f php --ri swoole","title":"\u5feb\u901f\u5f00\u59cb"},{"location":"\u5feb\u901f\u5f00\u59cb/#_1","text":"Swoole \u53ef\u4ee5\u901a\u8fc7 Pecl \u6216\u8005\u6e90\u7801\u6765\u8fdb\u884c\u5b89\u88c5\u3002","title":"\u5feb\u901f\u5f00\u59cb"},{"location":"\u5feb\u901f\u5f00\u59cb/#pecl","text":"\u9996\u5148\u901a\u8fc7 pecl \u5de5\u5177\u4e0b\u8f7d\u548c\u7f16\u8bd1 Swoole \u6269\u5c55\uff1a # \u5b89\u88c5\u6700\u65b0\u7248\u672c pecl install swoole # \u5b89\u88c5\u6307\u5b9a\u7248\u672c pecl install swoole-4.4.8 \u7f16\u8bd1\u6210\u529f\u4e4b\u540e\uff0c\u628a Swoole \u6dfb\u52a0\u5230 php.ini \u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u3002\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u67e5\u627e\uff0c\u4f8b\u5982\uff1a php --ini Configuration File (php.ini) Path: /etc Loaded Configuration File: /etc/php.ini Scan for additional .ini files in: /etc/php.d \u63a8\u8350\u5728 additional .ini \u76ee\u5f55\u91cc\u9762\u5355\u72ec\u4e3a Swoole \u521b\u5efa\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a touch /etc/php.d/swoole.ini cat > /etc/php.d/swoole.ini <<EOF ; Enable swoole extension module extension=swoole.so EOF","title":"Pecl\uff08\u63a8\u8350\uff09"},{"location":"\u5feb\u901f\u5f00\u59cb/#_2","text":"\u4e0b\u8f7d\u4e00\u4efd\u5df2\u7ecf release \u7684 Swoole \u6e90\u7801\uff1a curl -L https://github.com/swoole/swoole-src/archive/v4.4.12.tar.gz -o swoole-src-4.4.12.tar.gz \\ && tar -xvf swoole-src-4.4.12.tar.gz \\ && cd swoole-src-4.4.12 \\ && phpize \\ && ./configure \\ && make -j4 \\ && make install \u7136\u540e\u6309\u7167\u4e0a\u9762\u7684\u65b9\u5f0f\u628a Swoole \u6dfb\u52a0\u5230\u914d\u7f6e\u6587\u4ef6 php.ini \u91cc\u9762\u5373\u53ef\u3002","title":"\u6e90\u7801\u5b89\u88c5"},{"location":"\u5feb\u901f\u5f00\u59cb/#_3","text":"php --ri swoole","title":"\u9a8c\u8bc1\u662f\u5426\u5b89\u88c5\u6210\u529f"},{"location":"coroutine/scheduler/set/","text":"Coroutine::Set Coroutine::set \u7528\u6765\u8bbe\u7f6e\u534f\u7a0b\u76f8\u5173\u9009\u9879\u3002 Swoole\\Coroutine::set <?php public static function set($options) { } @param array $options @return mixed max_coroutine \u8bbe\u7f6e\u6700\u5927\u534f\u7a0b\u6570\uff0c\u8d85\u8fc7\u9650\u5236\u540e\u5e95\u5c42\u5c06\u65e0\u6cd5\u521b\u5efa\u65b0\u7684\u534f\u7a0b\u3002 \u6ce8\u610f\uff0c\u8fd9\u4e2a\u6700\u5927\u534f\u7a0b\u6570\u6307\u7684\u662f\u8fd9\u4e2a\u7ebf\u7a0b\u76ee\u524d\u5b58\u6d3b\u7684\u534f\u7a0b\u6570\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u7684\u534f\u7a0b\u4e2a\u6570\u3002\u56e0\u4e3a\u6b7b\u4ea1\u7684\u534f\u7a0b\u662f\u4e0d\u8bb0\u5f55\u5728\u534f\u7a0b\u4e2a\u6570\u91cc\u9762\u7684\u3002 \u4f8b\u5b50\uff1a <?php Swoole\\Coroutine::set([ 'max_coroutine' => 5, ]); for ($i=0; $i < 6; $i++) { go(function() { echo 'swoole' . PHP_EOL; }); } swoole swoole swoole swoole swoole swoole \u4f9d\u7136\u53ef\u4ee5\u521b\u5efa\u51fa 6 \u4e2a\u534f\u7a0b\u3002\u56e0\u4e3a\u534f\u7a0b\u521b\u5efa\u5b8c\u4e4b\u540e\uff0c\u6267\u884c echo \u5c31\u4f1a\u7acb\u9a6c\u6b7b\u4ea1\uff0c\u63a5\u7740\u521b\u5efa\u4e0b\u4e00\u4e2a\u534f\u7a0b\u3002 \u4f46\u662f\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u662f\u4f1a\u5931\u8d25\u7684\uff1a <?php Swoole\\Coroutine::set([ 'max_coroutine' => 5, ]); go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; }); }); }); }); }); }); php set.php swoole swoole swoole swoole swoole PHP Warning: go(): exceed max number of coroutine 5 in /root/codeDir/phpCode/swoole/coroutine/coroutine/set.php on line 19 hook_flags \u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u5c06\u57fa\u4e8e php_stream \u5b9e\u73b0\u7684\u6269\u5c55\u3001 PHP \u7f51\u7edc\u5ba2\u6237\u7aef\u4ee3\u7801\u4e00\u952e\u534f\u7a0b\u5316\u3002 Swoole \u521b\u5efa\u534f\u7a0b\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u662f\u4e0d\u4f1a hook \u7684\u3002 \u53ef\u4ee5 hook \u7684 flag \u6709\uff1a SWOOLE_HOOK_TCP \u4f8b\u5b50\uff1a hook \u7684 tcp \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_TCP, ]); Swoole\\Coroutine\\run(function () { go(function () { $ctx = stream_context_create(['socket' => ['so_reuseaddr' => true, 'backlog' => 128]]); $socket = stream_socket_server( 'tcp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN, $ctx ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 tcp \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $ctx = stream_context_create(['socket' => ['so_reuseaddr' => true, 'backlog' => 128]]); $socket = stream_socket_server( 'tcp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN, $ctx ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002 SWOOLE_HOOK_UDP hook \u7684 udp \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_UDP, ]); Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 udp \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002 SWOOLE_HOOK_UNIX hook \u7684 unix \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_UNIX, ]); Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'unix://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 unix \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'unix://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002 SWOOLE_HOOK_UDG hook \u7684 udg \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_UDG, ]); Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udg://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 udg \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udg://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002 SWOOLE_HOOK_SSL TODO SWOOLE_HOOK_TLS TODO SWOOLE_HOOK_STREAM_FUNCTION TODO SWOOLE_HOOK_FILE hook \u7684 file \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_FILE, ]); Swoole\\Coroutine\\run(function () { go(function () { $fp = fopen(__FILE__, 'r'); while (true) { fread($fp, 1024); } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 file \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $fp = fopen(__FILE__, 'r'); while (true) { fread($fp, 1024); } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002 SWOOLE_HOOK_SLEEP \u4f8b\u5b50\uff1a hook \u7684 sleep \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_SLEEP, ]); Swoole\\Coroutine\\run(function () { go(function () { sleep(1); echo '1' . PHP_EOL; }); go(function () { echo '2' . PHP_EOL; }); }); 2 1 \u6ca1\u6709 hook \u7684 sleep \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { sleep(1); echo '1' . PHP_EOL; }); go(function () { echo '2' . PHP_EOL; }); }); 1 2 SWOOLE_HOOK_PROC hook \u7684 proc \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_PROC, ]); Swoole\\Coroutine\\run(function () { go(function () { $descriptorspec = array( 0 => array(\"pipe\", \"r\"), // stdin, child process read from it 1 => array(\"pipe\", \"w\"), // stdout, child process write to it ); $process = proc_open('php', $descriptorspec, $pipes); if (is_resource($process)) { fwrite($pipes[0], '<?php echo \"I am process\\n\" ?>'); fclose($pipes[0]); while (true) { echo fread($pipes[1], 1024); } fclose($pipes[1]); $return_value = proc_close($process); echo \"command returned $return_value\" . PHP_EOL; } }); echo \"here\" . PHP_EOL; }); \u6253\u5370\u51fa here \u5b57\u7b26\u4e32\uff1a here I am process \u6ca1\u6709 hook \u7684 proc \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $descriptorspec = array( 0 => array(\"pipe\", \"r\"), // stdin, child process read from it 1 => array(\"pipe\", \"w\"), // stdout, child process write to it ); $process = proc_open('php', $descriptorspec, $pipes); if (is_resource($process)) { fwrite($pipes[0], '<?php echo \"I am process\\n\" ?>'); fclose($pipes[0]); while (true) { echo fread($pipes[1], 1024); } fclose($pipes[1]); $return_value = proc_close($process); echo \"command returned $return_value\" . PHP_EOL; } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\uff1a I am process SWOOLE_HOOK_BLOCKING_FUNCTION \u8fd9\u91cc\u7684 blocking function \u5305\u62ec\u4e86\uff1a gethostbyname \u3001 exec \u3001 shell_exec \u3002 hook \u7684 blocking function \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_BLOCKING_FUNCTION, ]); Swoole\\Coroutine\\run(function () { go(function () { while (true) { exec(\"cat\"); } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 blocking function \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { while (true) { exec(\"cat\"); } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002 SWOOLE_HOOK_CURL TODO c_stack_size \u8bbe\u7f6e\u5355\u4e2a\u534f\u7a0b\u521d\u59cb\u6808\u7684\u5185\u5b58\u5c3a\u5bf8\uff0c\u5355\u4f4d\u662f B \uff0c\u9ed8\u8ba4\u4e3a 2 * 1024 * 1024B \uff0c\u5373 2MB \u3002\u8303\u56f4\uff1a 256 * 1024B \uff5e 16 * 1024 * 1024 \u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u7684\u662f\u534f\u7a0b\u521d\u59cbC\u6808\u7684\u5927\u5c0f\uff0c\u800c\u4e0d\u662f\u534f\u7a0b\u521d\u59cbPHP\u6808\u7684\u5927\u5c0f\u3002 \u534f\u7a0b\u521d\u59cbPHP\u6808\u7684\u5927\u5c0f\u76ee\u524d\u662f\u56fa\u5b9a\u76848 * 1024B\u3002 socket_connect_timeout \u5efa\u7acb socket \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4, \u5355\u4f4d\uff1a s \uff0c\u9ed8\u8ba4\u4e3a 1s \u3002\u8bbe\u7f6e\u4e3a -1 \uff0c\u8868\u793a\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002 socket_timeout \u8bbe\u7f6e socket \u8bfb\u548c\u5199\u7684\u64cd\u4f5c\u8d85\u65f6\u65f6\u95f4, \u5355\u4f4d\uff1a s \uff0c\u9ed8\u8ba4\u4e3a -1 , \u5373\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002 socket_read_timeout \u53ea\u8bbe\u7f6e socket \u8bfb\u7684\u64cd\u4f5c\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d s \uff0c\u9ed8\u8ba4\u4e3a -1 , \u5373\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002 socket_write_timeout \u53ea\u8bbe\u7f6e socket \u5199\u7684\u64cd\u4f5c\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d s \uff0c\u9ed8\u8ba4\u4e3a -1 , \u5373\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002 log_level \u8bbe\u7f6e\u65e5\u5fd7\u7b49\u7ea7\u3002\u5927\u4e8e\u7b49\u4e8e\u8fd9\u4e2a\u65e5\u5fd7\u7b49\u7ea7\u7684\u65e5\u5fd7 \u624d \u4f1a\u88ab\u6253\u5370\u51fa\u6765\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u914d\u7f6e\u7684\u4e0d\u662fPHP\u5c42\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u800c\u662fC\u5c42\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u540e\u9762\u4f1a\u6709\u4e00\u4e2a\u4f8b\u5b50\u8fdb\u884c\u8bf4\u660e\u3002 \u53ef\u914d\u7f6e\u7684\u65e5\u5fd7\u7b49\u7ea7\u4ece\u4f4e\u5230\u9ad8\u4e3a\uff1a SWOOLE_LOG_DEBUG SWOOLE_LOG_TRACE SWOOLE_LOG_INFO SWOOLE_LOG_NOTICE SWOOLE_LOG_WARNING SWOOLE_LOG_ERROR \u6ce8\u610f\uff0c\u5982\u679c\u5728\u7f16\u8bd1 Swoole \u7684\u65f6\u5019\u5f00\u542f\u4e86 debug \uff0c\u90a3\u4e48 log_level \u9ed8\u8ba4\u662f SWOOLE_LOG_DEBUG \uff1b\u5426\u5219 log_level \u9ed8\u8ba4\u662f SWOOLE_LOG_INFO \u3002 \u6ca1\u6709\u8bbe\u7f6e log_level \u7684\u4f8b\u5b50\uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $client = new Swoole\\Coroutine\\Client(SWOOLE_TCP); $client->connect('127.0.0.1'); }); }); \u6b64\u65f6\u4f1a\u6253\u5370 PHP \u5c42 Warning \u7ea7\u522b\u7684\u8b66\u544a\uff1a PHP Warning: Swoole\\Coroutine\\Client::connect(): The port is invalid in /root/codeDir/phpCode/swoole/coroutine/coroutine/set.php on line 6 \u8bbe\u7f6e log_level \u7684\u4f8b\u5b50\uff1a <?php Swoole\\Coroutine::set([ 'log_level' => SWOOLE_LOG_ERROR, ]); Swoole\\Coroutine\\run(function () { go(function () { $client = new Swoole\\Coroutine\\Client(SWOOLE_TCP); $client->connect('127.0.0.1'); }); }); \u6b64\u65f6\u4f9d\u7136\u4f1a\u6253\u5370\u51fa PHP \u5c42 Warning \u7ea7\u522b\u7684\u8b66\u544a\uff1a PHP Warning: Swoole\\Coroutine\\Client::connect(): The port is invalid in /root/codeDir/phpCode/swoole/coroutine/coroutine/set.php on line 10 trace_flags TODO dns_cache_expire \u8bbe\u7f6e swoole dns \u7f13\u5b58\u5931\u6548\u65f6\u95f4\uff0c\u5355\u4f4d s \uff0c\u9ed8\u8ba4 60s \u3002 dns_cache_capacity \u8bbe\u7f6e swoole dns \u7f13\u5b58\u5bb9\u91cf\uff0c\u9ed8\u8ba4 1000 \u3002 dns_server TODO display_errors TODO aio_core_worker_num TODO aio_worker_num TODO aio_max_wait_time TODO aio_max_idle_time TODO","title":"Scheduler::Set"},{"location":"coroutine/scheduler/set/#coroutineset","text":"Coroutine::set \u7528\u6765\u8bbe\u7f6e\u534f\u7a0b\u76f8\u5173\u9009\u9879\u3002 Swoole\\Coroutine::set <?php public static function set($options) { } @param array $options @return mixed","title":"Coroutine::Set"},{"location":"coroutine/scheduler/set/#max_coroutine","text":"\u8bbe\u7f6e\u6700\u5927\u534f\u7a0b\u6570\uff0c\u8d85\u8fc7\u9650\u5236\u540e\u5e95\u5c42\u5c06\u65e0\u6cd5\u521b\u5efa\u65b0\u7684\u534f\u7a0b\u3002 \u6ce8\u610f\uff0c\u8fd9\u4e2a\u6700\u5927\u534f\u7a0b\u6570\u6307\u7684\u662f\u8fd9\u4e2a\u7ebf\u7a0b\u76ee\u524d\u5b58\u6d3b\u7684\u534f\u7a0b\u6570\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u7684\u534f\u7a0b\u4e2a\u6570\u3002\u56e0\u4e3a\u6b7b\u4ea1\u7684\u534f\u7a0b\u662f\u4e0d\u8bb0\u5f55\u5728\u534f\u7a0b\u4e2a\u6570\u91cc\u9762\u7684\u3002 \u4f8b\u5b50\uff1a <?php Swoole\\Coroutine::set([ 'max_coroutine' => 5, ]); for ($i=0; $i < 6; $i++) { go(function() { echo 'swoole' . PHP_EOL; }); } swoole swoole swoole swoole swoole swoole \u4f9d\u7136\u53ef\u4ee5\u521b\u5efa\u51fa 6 \u4e2a\u534f\u7a0b\u3002\u56e0\u4e3a\u534f\u7a0b\u521b\u5efa\u5b8c\u4e4b\u540e\uff0c\u6267\u884c echo \u5c31\u4f1a\u7acb\u9a6c\u6b7b\u4ea1\uff0c\u63a5\u7740\u521b\u5efa\u4e0b\u4e00\u4e2a\u534f\u7a0b\u3002 \u4f46\u662f\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u662f\u4f1a\u5931\u8d25\u7684\uff1a <?php Swoole\\Coroutine::set([ 'max_coroutine' => 5, ]); go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; go(function() { echo 'swoole' . PHP_EOL; }); }); }); }); }); }); php set.php swoole swoole swoole swoole swoole PHP Warning: go(): exceed max number of coroutine 5 in /root/codeDir/phpCode/swoole/coroutine/coroutine/set.php on line 19","title":"max_coroutine"},{"location":"coroutine/scheduler/set/#hook_flags","text":"\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u5c06\u57fa\u4e8e php_stream \u5b9e\u73b0\u7684\u6269\u5c55\u3001 PHP \u7f51\u7edc\u5ba2\u6237\u7aef\u4ee3\u7801\u4e00\u952e\u534f\u7a0b\u5316\u3002 Swoole \u521b\u5efa\u534f\u7a0b\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u662f\u4e0d\u4f1a hook \u7684\u3002 \u53ef\u4ee5 hook \u7684 flag \u6709\uff1a","title":"hook_flags"},{"location":"coroutine/scheduler/set/#swoole_hook_tcp","text":"\u4f8b\u5b50\uff1a hook \u7684 tcp \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_TCP, ]); Swoole\\Coroutine\\run(function () { go(function () { $ctx = stream_context_create(['socket' => ['so_reuseaddr' => true, 'backlog' => 128]]); $socket = stream_socket_server( 'tcp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN, $ctx ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 tcp \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $ctx = stream_context_create(['socket' => ['so_reuseaddr' => true, 'backlog' => 128]]); $socket = stream_socket_server( 'tcp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN, $ctx ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002","title":"SWOOLE_HOOK_TCP"},{"location":"coroutine/scheduler/set/#swoole_hook_udp","text":"hook \u7684 udp \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_UDP, ]); Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 udp \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udp://0.0.0.0:6666', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002","title":"SWOOLE_HOOK_UDP"},{"location":"coroutine/scheduler/set/#swoole_hook_unix","text":"hook \u7684 unix \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_UNIX, ]); Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'unix://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 unix \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'unix://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND | STREAM_SERVER_LISTEN ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_accept($socket)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002","title":"SWOOLE_HOOK_UNIX"},{"location":"coroutine/scheduler/set/#swoole_hook_udg","text":"hook \u7684 udg \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_UDG, ]); Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udg://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 udg \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $socket = stream_socket_server( 'udg://swoole.sock', $errno, $errstr, STREAM_SERVER_BIND ); if (!$socket) { echo \"$errstr ($errno)\" . PHP_EOL; exit(1); } while (stream_socket_recvfrom($socket, 1, 0)) { } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002","title":"SWOOLE_HOOK_UDG"},{"location":"coroutine/scheduler/set/#swoole_hook_ssl","text":"TODO","title":"SWOOLE_HOOK_SSL"},{"location":"coroutine/scheduler/set/#swoole_hook_tls","text":"TODO","title":"SWOOLE_HOOK_TLS"},{"location":"coroutine/scheduler/set/#swoole_hook_stream_function","text":"TODO","title":"SWOOLE_HOOK_STREAM_FUNCTION"},{"location":"coroutine/scheduler/set/#swoole_hook_file","text":"hook \u7684 file \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_FILE, ]); Swoole\\Coroutine\\run(function () { go(function () { $fp = fopen(__FILE__, 'r'); while (true) { fread($fp, 1024); } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 file \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $fp = fopen(__FILE__, 'r'); while (true) { fread($fp, 1024); } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002","title":"SWOOLE_HOOK_FILE"},{"location":"coroutine/scheduler/set/#swoole_hook_sleep","text":"\u4f8b\u5b50\uff1a hook \u7684 sleep \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_SLEEP, ]); Swoole\\Coroutine\\run(function () { go(function () { sleep(1); echo '1' . PHP_EOL; }); go(function () { echo '2' . PHP_EOL; }); }); 2 1 \u6ca1\u6709 hook \u7684 sleep \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { sleep(1); echo '1' . PHP_EOL; }); go(function () { echo '2' . PHP_EOL; }); }); 1 2","title":"SWOOLE_HOOK_SLEEP"},{"location":"coroutine/scheduler/set/#swoole_hook_proc","text":"hook \u7684 proc \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_PROC, ]); Swoole\\Coroutine\\run(function () { go(function () { $descriptorspec = array( 0 => array(\"pipe\", \"r\"), // stdin, child process read from it 1 => array(\"pipe\", \"w\"), // stdout, child process write to it ); $process = proc_open('php', $descriptorspec, $pipes); if (is_resource($process)) { fwrite($pipes[0], '<?php echo \"I am process\\n\" ?>'); fclose($pipes[0]); while (true) { echo fread($pipes[1], 1024); } fclose($pipes[1]); $return_value = proc_close($process); echo \"command returned $return_value\" . PHP_EOL; } }); echo \"here\" . PHP_EOL; }); \u6253\u5370\u51fa here \u5b57\u7b26\u4e32\uff1a here I am process \u6ca1\u6709 hook \u7684 proc \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $descriptorspec = array( 0 => array(\"pipe\", \"r\"), // stdin, child process read from it 1 => array(\"pipe\", \"w\"), // stdout, child process write to it ); $process = proc_open('php', $descriptorspec, $pipes); if (is_resource($process)) { fwrite($pipes[0], '<?php echo \"I am process\\n\" ?>'); fclose($pipes[0]); while (true) { echo fread($pipes[1], 1024); } fclose($pipes[1]); $return_value = proc_close($process); echo \"command returned $return_value\" . PHP_EOL; } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\uff1a I am process","title":"SWOOLE_HOOK_PROC"},{"location":"coroutine/scheduler/set/#swoole_hook_blocking_function","text":"\u8fd9\u91cc\u7684 blocking function \u5305\u62ec\u4e86\uff1a gethostbyname \u3001 exec \u3001 shell_exec \u3002 hook \u7684 blocking function \uff1a <?php Swoole\\Coroutine::set([ 'hook_flags' => SWOOLE_HOOK_BLOCKING_FUNCTION, ]); Swoole\\Coroutine\\run(function () { go(function () { while (true) { exec(\"cat\"); } }); echo \"here\" . PHP_EOL; }); here \u6ca1\u6709 hook \u7684 blocking function \uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { while (true) { exec(\"cat\"); } }); echo \"here\" . PHP_EOL; }); \u6b64\u65f6\u4e0d\u4f1a\u6253\u5370\u51fa here \u5b57\u7b26\u4e32\u3002","title":"SWOOLE_HOOK_BLOCKING_FUNCTION"},{"location":"coroutine/scheduler/set/#swoole_hook_curl","text":"TODO","title":"SWOOLE_HOOK_CURL"},{"location":"coroutine/scheduler/set/#c_stack_size","text":"\u8bbe\u7f6e\u5355\u4e2a\u534f\u7a0b\u521d\u59cb\u6808\u7684\u5185\u5b58\u5c3a\u5bf8\uff0c\u5355\u4f4d\u662f B \uff0c\u9ed8\u8ba4\u4e3a 2 * 1024 * 1024B \uff0c\u5373 2MB \u3002\u8303\u56f4\uff1a 256 * 1024B \uff5e 16 * 1024 * 1024 \u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u7684\u662f\u534f\u7a0b\u521d\u59cbC\u6808\u7684\u5927\u5c0f\uff0c\u800c\u4e0d\u662f\u534f\u7a0b\u521d\u59cbPHP\u6808\u7684\u5927\u5c0f\u3002 \u534f\u7a0b\u521d\u59cbPHP\u6808\u7684\u5927\u5c0f\u76ee\u524d\u662f\u56fa\u5b9a\u76848 * 1024B\u3002","title":"c_stack_size"},{"location":"coroutine/scheduler/set/#socket_connect_timeout","text":"\u5efa\u7acb socket \u8fde\u63a5\u8d85\u65f6\u65f6\u95f4, \u5355\u4f4d\uff1a s \uff0c\u9ed8\u8ba4\u4e3a 1s \u3002\u8bbe\u7f6e\u4e3a -1 \uff0c\u8868\u793a\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002","title":"socket_connect_timeout"},{"location":"coroutine/scheduler/set/#socket_timeout","text":"\u8bbe\u7f6e socket \u8bfb\u548c\u5199\u7684\u64cd\u4f5c\u8d85\u65f6\u65f6\u95f4, \u5355\u4f4d\uff1a s \uff0c\u9ed8\u8ba4\u4e3a -1 , \u5373\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002","title":"socket_timeout"},{"location":"coroutine/scheduler/set/#socket_read_timeout","text":"\u53ea\u8bbe\u7f6e socket \u8bfb\u7684\u64cd\u4f5c\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d s \uff0c\u9ed8\u8ba4\u4e3a -1 , \u5373\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002","title":"socket_read_timeout"},{"location":"coroutine/scheduler/set/#socket_write_timeout","text":"\u53ea\u8bbe\u7f6e socket \u5199\u7684\u64cd\u4f5c\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d s \uff0c\u9ed8\u8ba4\u4e3a -1 , \u5373\u6c38\u4e0d\u8d85\u65f6\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u8bbe\u7f6e\u4e3a0\u3002\u8bbe\u7f6e\u4e3a0\u7684\u8bdd\uff0c\u4f1a\u53d6\u9ed8\u8ba4\u503c\u3002","title":"socket_write_timeout"},{"location":"coroutine/scheduler/set/#log_level","text":"\u8bbe\u7f6e\u65e5\u5fd7\u7b49\u7ea7\u3002\u5927\u4e8e\u7b49\u4e8e\u8fd9\u4e2a\u65e5\u5fd7\u7b49\u7ea7\u7684\u65e5\u5fd7 \u624d \u4f1a\u88ab\u6253\u5370\u51fa\u6765\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u914d\u7f6e\u7684\u4e0d\u662fPHP\u5c42\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u800c\u662fC\u5c42\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u540e\u9762\u4f1a\u6709\u4e00\u4e2a\u4f8b\u5b50\u8fdb\u884c\u8bf4\u660e\u3002 \u53ef\u914d\u7f6e\u7684\u65e5\u5fd7\u7b49\u7ea7\u4ece\u4f4e\u5230\u9ad8\u4e3a\uff1a SWOOLE_LOG_DEBUG SWOOLE_LOG_TRACE SWOOLE_LOG_INFO SWOOLE_LOG_NOTICE SWOOLE_LOG_WARNING SWOOLE_LOG_ERROR \u6ce8\u610f\uff0c\u5982\u679c\u5728\u7f16\u8bd1 Swoole \u7684\u65f6\u5019\u5f00\u542f\u4e86 debug \uff0c\u90a3\u4e48 log_level \u9ed8\u8ba4\u662f SWOOLE_LOG_DEBUG \uff1b\u5426\u5219 log_level \u9ed8\u8ba4\u662f SWOOLE_LOG_INFO \u3002 \u6ca1\u6709\u8bbe\u7f6e log_level \u7684\u4f8b\u5b50\uff1a <?php Swoole\\Coroutine\\run(function () { go(function () { $client = new Swoole\\Coroutine\\Client(SWOOLE_TCP); $client->connect('127.0.0.1'); }); }); \u6b64\u65f6\u4f1a\u6253\u5370 PHP \u5c42 Warning \u7ea7\u522b\u7684\u8b66\u544a\uff1a PHP Warning: Swoole\\Coroutine\\Client::connect(): The port is invalid in /root/codeDir/phpCode/swoole/coroutine/coroutine/set.php on line 6 \u8bbe\u7f6e log_level \u7684\u4f8b\u5b50\uff1a <?php Swoole\\Coroutine::set([ 'log_level' => SWOOLE_LOG_ERROR, ]); Swoole\\Coroutine\\run(function () { go(function () { $client = new Swoole\\Coroutine\\Client(SWOOLE_TCP); $client->connect('127.0.0.1'); }); }); \u6b64\u65f6\u4f9d\u7136\u4f1a\u6253\u5370\u51fa PHP \u5c42 Warning \u7ea7\u522b\u7684\u8b66\u544a\uff1a PHP Warning: Swoole\\Coroutine\\Client::connect(): The port is invalid in /root/codeDir/phpCode/swoole/coroutine/coroutine/set.php on line 10","title":"log_level"},{"location":"coroutine/scheduler/set/#trace_flags","text":"TODO","title":"trace_flags"},{"location":"coroutine/scheduler/set/#dns_cache_expire","text":"\u8bbe\u7f6e swoole dns \u7f13\u5b58\u5931\u6548\u65f6\u95f4\uff0c\u5355\u4f4d s \uff0c\u9ed8\u8ba4 60s \u3002","title":"dns_cache_expire"},{"location":"coroutine/scheduler/set/#dns_cache_capacity","text":"\u8bbe\u7f6e swoole dns \u7f13\u5b58\u5bb9\u91cf\uff0c\u9ed8\u8ba4 1000 \u3002","title":"dns_cache_capacity"},{"location":"coroutine/scheduler/set/#dns_server","text":"TODO","title":"dns_server"},{"location":"coroutine/scheduler/set/#display_errors","text":"TODO","title":"display_errors"},{"location":"coroutine/scheduler/set/#aio_core_worker_num","text":"TODO","title":"aio_core_worker_num"},{"location":"coroutine/scheduler/set/#aio_worker_num","text":"TODO","title":"aio_worker_num"},{"location":"coroutine/scheduler/set/#aio_max_wait_time","text":"TODO","title":"aio_max_wait_time"},{"location":"coroutine/scheduler/set/#aio_max_idle_time","text":"TODO","title":"aio_max_idle_time"}]}